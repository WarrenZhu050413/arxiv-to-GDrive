# Paper-to-GDrive Extension TODOs

## Code Refactoring
- [x] Create a proper utils folder structure:
  - [x] Create a utils/common directory
  - [x] Create utils/common/window_utils.js for popup operations
  - [x] Create utils/common/storage_utils.js for state management
  - [x] Create utils/common/notification_utils.js for messaging
  - [x] Create utils/common/error_utils.js for error handling

## Fix Command+X and Command+Shift+P Issues
- [x] Fix popup opening mechanism in background.js:
  - [x] Improve openExtensionPopup() function to reliably open the popup
  - [x] Remove unnecessary storage checks before opening the popup
  - [x] Add proper error handling for popup operations
- [x] Fix popup closing mechanism:
  - [x] Implement a robust popup closing function for Command+Shift+P
  - [x] Add keyboard shortcut listeners in popup.js for Command+Shift+P
- [x] Improve Command+X toggle logic:
  - [x] Simplify the state tracking
  - [x] Implement proper detection of whether popup is already open

## State Management
- [x] Create a unified state management approach:
  - [x] Implement proper state tracking for customTitleMode
  - [x] Add reliable methods to check if the popup is open
  - [x] Remove direct manipulation of customTitleModeActive variable

## Performance Optimization
- [x] Reduce latency in Command+X operation:
  - [x] Use Promise.all() for parallel operations where possible
  - [x] Cache data when feasible
  - [x] Show the popup immediately upon Command+X, then load data

## Event Handling
- [x] Fix keyboard shortcut handling:
  - [x] Implement reliable event listeners for Command+Shift+P
  - [x] Fix issues with key detection (case sensitivity, event properties)

## Testing
- [ ] Test all keyboard shortcuts
  - [ ] Test Command+X in various states
  - [ ] Test Command+Shift+P in various states
  - [ ] Test repeated usages of shortcuts 